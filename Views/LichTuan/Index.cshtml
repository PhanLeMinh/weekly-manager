@model IEnumerable<WeeklyScheduleManagement.Models.LichTuan>

@{
    ViewData["Title"] = "Qu·∫£n L√Ω L·ªãch Tu·∫ßn";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row mb-4">
    <div class="col-md-8">
        <h2><i class="fas fa-calendar-week"></i> Qu·∫£n L√Ω L·ªãch Tu·∫ßn L√†m Vi·ªác</h2>
        <p class="text-muted">Danh s√°ch t·∫•t c·∫£ l·ªãch tu·∫ßn l√†m vi·ªác</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="/LichTuan/Create" class="btn btn-create">
            <i class="fas fa-plus-circle"></i> ƒêƒÉng K√Ω L·ªãch M·ªõi
        </a>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle"></i> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="filter-section mb-4">
    <form method="get" asp-action="Index">
        <div class="row g-3">
            <div class="col-md-5">
                <input type="text" name="searchString" value="@ViewData["CurrentFilter"]" 
                       class="form-control" placeholder="üîç T√¨m ki·∫øm theo t√™n l·ªãch...">
            </div>
            <div class="col-md-4">
                <select name="trangThai" class="form-select">
                    <option value="">-- T·∫•t c·∫£ tr·∫°ng th√°i --</option>
                    <option value="ChoDuyet" selected="@(ViewData["TrangThaiFilter"]?.ToString() == "ChoDuyet")">Ch·ªù duy·ªát</option>
                    <option value="DaDuyet" selected="@(ViewData["TrangThaiFilter"]?.ToString() == "DaDuyet")">ƒê√£ duy·ªát</option>
                    <option value="TuChoi" selected="@(ViewData["TrangThaiFilter"]?.ToString() == "TuChoi")">T·ª´ ch·ªëi</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search"></i> T√¨m ki·∫øm
                </button>
            </div>
        </div>
    </form>
</div>

@if (Model != null && Model.Any())
{
    <p class="text-muted mb-3">
        <i class="fas fa-info-circle"></i> T·ªïng s·ªë: <strong>@Model.Count()</strong> l·ªãch tu·∫ßn
    </p>

    @foreach (var item in Model)
    {
        <div class="schedule-card mb-3">
            <div class="row">
                <div class="col-md-9">
                    <h5 class="mb-3">
                        <i class="fas fa-clipboard-list text-primary"></i> @item.TenLichTuan
                    </h5>
                    
                    <div class="info-row">
                        <i class="fas fa-user"></i>
                        <span><strong>Ng∆∞·ªùi ƒëƒÉng k√Ω:</strong> @(item.NguoiDangKy?.HoTen ?? "N/A")</span>
                    </div>
                    
                    <div class="info-row">
                        <i class="fas fa-crown"></i>
                        <span><strong>Ch·ªß tr√¨:</strong> @(item.ChuTri?.HoTen ?? "N/A")</span>
                    </div>
                    
                    <div class="info-row">
                        <i class="fas fa-map-marker-alt"></i>
                        <span><strong>ƒê·ªãa ƒëi·ªÉm:</strong> @(item.DiaDiem?.TenDiaDiem ?? "N/A")</span>
                    </div>
                    
                    <div class="info-row">
                        <i class="fas fa-clock"></i>
                        <span><strong>Th·ªùi gian:</strong> @item.NgayBatDau.ToString("dd/MM/yyyy HH:mm") - @item.NgayKetThuc.ToString("dd/MM/yyyy HH:mm")</span>
                    </div>
                    
                    <div class="info-row">
                        <i class="fas fa-align-left"></i>
                        <span><strong>N·ªôi dung:</strong> @item.NoiDung</span>
                    </div>

                    @if (item.TrangThai == "TuChoi" && !string.IsNullOrEmpty(item.LyDoTuChoi))
                    {
                        <div class="info-row text-danger">
                            <i class="fas fa-times-circle"></i>
                            <span><strong>L√Ω do t·ª´ ch·ªëi:</strong> @item.LyDoTuChoi</span>
                        </div>
                    }
                </div>
                
                <div class="col-md-3 text-end">
                    <div class="mb-3">
                        @switch (item.TrangThai)
                        {
                            case "ChoDuyet":
                                <span class="status-badge status-choduyet">
                                    <i class="fas fa-hourglass-half"></i> Ch·ªù duy·ªát
                                </span>
                                break;
                            case "DaDuyet":
                                <span class="status-badge status-daduyet">
                                    <i class="fas fa-check-circle"></i> ƒê√£ duy·ªát
                                </span>
                                break;
                            case "TuChoi":
                                <span class="status-badge status-tuchoi">
                                    <i class="fas fa-times-circle"></i> T·ª´ ch·ªëi
                                </span>
                                break;
                        }
                    </div>

                    <div class="d-flex flex-column gap-2">
                        <a href="/LichTuan/Details/@item.MaLichTuan" class="btn btn-info btn-sm">
                            <i class="fas fa-eye"></i> Chi ti·∫øt
                        </a>

                        @if (item.TrangThai == "ChoDuyet")
                        {
                            <a href="/LichTuan/Edit/@item.MaLichTuan" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i> S·ª≠a
                            </a>
                            
                            @if (User.IsInRole("Manager") || User.IsInRole("Admin"))
                            {
                                <a href="/LichTuan/Approve/@item.MaLichTuan" class="btn btn-success btn-sm">
                                    <i class="fas fa-check"></i> Duy·ªát
                                </a>
                            }
                        }

                        <a href="/LichTuan/Delete/@item.MaLichTuan" class="btn btn-danger btn-sm" 
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?')">
                            <i class="fas fa-trash"></i> X√≥a
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
}
else
{
    <div class="empty-state">
        <i class="fas fa-calendar-times fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">Ch∆∞a c√≥ l·ªãch tu·∫ßn n√†o</h4>
        <p class="text-muted">Nh·∫•n v√†o n√∫t "ƒêƒÉng K√Ω L·ªãch M·ªõi" ƒë·ªÉ t·∫°o l·ªãch tu·∫ßn ƒë·∫ßu ti√™n</p>
        <a href="/LichTuan/Create" class="btn btn-create mt-3">
            <i class="fas fa-plus-circle"></i> ƒêƒÉng K√Ω Ngay
        </a>
    </div>
}

<style>
    .btn-create {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        transition: transform 0.3s;
    }
    .btn-create:hover {
        transform: scale(1.05);
        color: white;
    }
    .filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
    }
    .schedule-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .schedule-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .info-row {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 0;
        font-size: 0.95rem;
    }
    .info-row i {
        width: 20px;
        color: #667eea;
    }
    .status-badge {
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
    }
    .status-choduyet { background: #fff3cd; color: #856404; }
    .status-daduyet { background: #d1e7dd; color: #0f5132; }
    .status-tuchoi { background: #f8d7da; color: #842029; }
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: #f8f9fa;
        border-radius: 15px;
    }
</style>